# WindSurf 管理后台功能介绍

## 系统概述

WindSurf 管理后台是 WindSurf 续杯工具的核心管理系统，用于管理激活码发放、账号池维护、用户权限控制等功能。

---

## 功能模块

### 1. 用户认证

#### 1.1 登录
- **路径**: `/login`
- **功能**: 管理员账号密码登录
- **默认账号**: `admin` / `Admin@123456`
- **安全特性**:
  - JWT Token 认证
  - Token 存储在 localStorage
  - 自动过期处理

#### 1.2 修改密码
- **路径**: `/change-password`
- **功能**: 修改当前登录用户密码
- **要求**: 新密码至少 6 个字符

#### 1.3 退出登录
- 清除本地 Token
- 跳转到登录页

---

### 2. 仪表盘 (Dashboard)

#### 2.1 数据统计
| 指标 | 说明 |
|------|------|
| 总激活码 | 系统中的激活码总数 |
| 活跃激活码 | 状态为激活的激活码数量 |
| 过期激活码 | 已过期的激活码数量 |
| 总账号数 | 账号池中的账号总数 |
| 可用账号 | 未分配的可用账号数量 |
| 已分配账号 | 已分配给用户的账号数量 |
| 活跃用户 | 当前活跃的用户数量 |
| 已提号次数 | 累计的提号操作次数 |

#### 2.2 使用趋势图
- 显示最近一周的提号/切号趋势
- 折线图展示，支持 Tooltip

#### 2.3 最近操作日志
- 显示最近的操作记录
- 包含：激活码、操作类型、描述、时间
- 操作类型：
  - `activate` - 激活 (蓝色)
  - `pickup` - 提号 (绿色)
  - `switch` - 切号 (橙色)
  - `expire` - 过期 (红色)

---

### 3. 激活码管理

#### 3.1 激活码列表
- **路径**: `/activation-codes`
- **功能**: 查看所有激活码
- **支持操作**:
  - 搜索激活码
  - 按状态筛选 (激活/过期/禁用)
  - 分页显示

#### 3.2 生成激活码
- **批量生成**: 一次可生成 1-100 个
- **配置项**:
  - 最大提号数量 (1-100)
  - 有效期设置:
    - 按天数 (1-365 天)
    - 指定过期时间
- **激活码格式**: `前缀-XXXX-XXXX-XXXX`

#### 3.3 激活码操作
| 操作 | 说明 |
|------|------|
| 查看详情 | 显示激活码完整信息和使用日志 |
| 禁用 | 将激活状态改为禁用 |
| 启用 | 将禁用状态改为激活 |
| 删除 | 永久删除激活码 |

#### 3.4 激活码详情
- 基本信息：激活码、状态、提号限制、有效期、创建时间
- 使用日志：操作类型、关联账号、描述、时间

---

### 4. 账号管理

#### 4.1 账号统计
| 指标 | 说明 |
|------|------|
| 总账号数 | 账号池总数 |
| 可用账号 | 未分配且状态为可用的账号 |
| 已分配 | 已分配给激活码使用的账号 |
| 使用率 | 已分配账号占总数的百分比 |

⚠️ **库存预警**: 可用账号 ≤5 时显示红色警告

#### 4.2 账号列表
- **搜索**: 按邮箱或名称搜索
- **筛选**: 
  - 状态筛选 (可用/停用/使用中)
  - 分配状态筛选 (已分配/未分配)

#### 4.3 添加账号

**单个添加**:
- 邮箱 (必填，需有效格式)
- 账号名称 (必填)
- API Key (必填)

**批量导入**:
- 格式：`邮箱,名称,API Key` (每行一个)
- 自动跳过重复账号
- 显示成功/失败数量

**Token 添加**:
- 通过 Token 自动解析账号信息
- 使用独立弹窗组件

#### 4.4 账号操作
| 操作 | 说明 |
|------|------|
| 重置 | 重置已分配账号的分配状态 |
| 编辑 | 修改账号信息和状态 |
| 删除 | 永久删除账号 |
| 批量重置分配 | 重置所有账号的分配状态 |

---

### 5. Token 导入

#### 5.1 功能说明
- **路径**: `/token-import`
- **用途**: 通过 WindSurf Token 导入账号
- **状态**: 预留功能，解析逻辑待实现

#### 5.2 Token 格式
```json
{
  "email": "user@example.com",
  "name": "User Name",
  "apiKey": "sk-xxxxxxxxxxxxxxxxxxxxxx"
}
```

#### 5.3 注意事项
- Token 必须有效
- 自动提取邮箱、名称、API Key
- 重复账号自动跳过

---

### 6. 管理员管理

#### 6.1 管理员列表
- **路径**: `/admin-management`
- **显示信息**: 用户名、邮箱、角色、状态、最后登录、创建时间

#### 6.2 角色类型
| 角色 | 权限 |
|------|------|
| 超级管理员 | 所有权限，包括系统配置 |
| 管理员 | 基础管理权限 |

#### 6.3 管理员操作
| 操作 | 说明 | 权限要求 |
|------|------|----------|
| 添加管理员 | 创建新管理员账号 | 超级管理员 |
| 重置密码 | 重置其他管理员密码 | 超级管理员 |
| 禁用/启用 | 切换管理员状态 | 超级管理员 |
| 删除 | 删除管理员账号 | 超级管理员 |

⚠️ **限制**: 
- 不能操作自己的账号
- 不能操作超级管理员

---

### 7. 系统配置

#### 7.1 配置项
| 配置 | 说明 | 范围 |
|------|------|------|
| 激活码前缀 | 生成激活码的前缀 | 最多 5 字符 |
| 激活码长度 | 不含前缀的字符长度 | 8-32 |
| 默认有效天数 | 新激活码的默认有效期 | 1-365 天 |
| 默认最大账号数 | 每个激活码的默认提号上限 | 1-100 |

#### 7.2 权限控制
- **查看**: 所有管理员
- **修改**: 仅超级管理员

---

## API 接口

### 认证相关
| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/api/auth/login` | 登录 |
| POST | `/api/auth/change-password` | 修改密码 |

### 激活码相关
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/activation/list` | 获取激活码列表 |
| POST | `/api/activation/create` | 生成激活码 |
| GET | `/api/activation/:id/details` | 获取详情 |
| PUT | `/api/activation/:id/status` | 更新状态 |
| DELETE | `/api/activation/:id` | 删除激活码 |

### 账号相关
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/account/list` | 获取账号列表 |
| GET | `/api/account/statistics` | 获取统计数据 |
| POST | `/api/account/add` | 添加账号 |
| POST | `/api/account/batch-add` | 批量添加 |
| POST | `/api/account/import-token` | Token 导入 |
| PUT | `/api/account/:id` | 更新账号 |
| DELETE | `/api/account/:id` | 删除账号 |
| POST | `/api/account/reset-assignment/:id` | 重置分配 |
| POST | `/api/account/reset-all-assignments` | 批量重置 |

### 管理员相关
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/admin/list` | 获取管理员列表 |
| GET | `/api/admin/statistics` | 获取统计数据 |
| GET | `/api/admin/config` | 获取系统配置 |
| POST | `/api/admin/add` | 添加管理员 |
| PUT | `/api/admin/:id/status` | 更新状态 |
| PUT | `/api/admin/:id/reset-password` | 重置密码 |
| PUT | `/api/admin/config` | 更新配置 |
| DELETE | `/api/admin/:id` | 删除管理员 |

---

## 文件结构

```
admin-frontend/
├── src/
│   ├── components/
│   │   ├── MainLayout.js      # 主布局组件
│   │   └── AddAccountWithToken.js  # Token添加弹窗
│   ├── pages/
│   │   ├── Login.js           # 登录页
│   │   ├── Dashboard.js       # 仪表盘
│   │   ├── ActivationCodes.js # 激活码管理
│   │   ├── Accounts.js        # 账号管理
│   │   ├── TokenImport.js     # Token导入
│   │   ├── AdminManagement.js # 管理员管理
│   │   ├── SystemConfig.js    # 系统配置
│   │   └── ChangePassword.js  # 修改密码
│   ├── utils/
│   │   ├── auth.js            # 认证工具
│   │   └── request.js         # HTTP 请求封装
│   ├── App.js                 # 应用入口
│   ├── index.js               # 渲染入口
│   └── index.css              # 全局样式
├── public/
├── package.json
└── craco.config.js
```

---

## 快速开始

```bash
# 安装依赖
npm install

# 开发模式
npm start

# 生产构建
npm run build
```

**访问地址**: http://localhost:3000

**默认账号**: admin / Admin@123456

---

## 注意事项

1. 后端服务需运行在 `http://localhost:3001`
2. 首次使用需初始化数据库
3. 建议及时修改默认密码
4. 定期检查账号池库存
